create database stock;
use stock;

CREATE TABLE closing_prices (
    stock_id VARCHAR(10) NOT NULL,
    date DATE NOT NULL,
    closing_price DECIMAL(10, 2),
    PRIMARY KEY (stock_id, date)
) PARTITION BY RANGE(YEAR(date)) (
    PARTITION p88 VALUES LESS THAN (1999),  -- 民國88年，西元1999年
    PARTITION p89 VALUES LESS THAN (2000),
    PARTITION p90 VALUES LESS THAN (2001),
    PARTITION p91 VALUES LESS THAN (2002),
    PARTITION p92 VALUES LESS THAN (2003),
    PARTITION p93 VALUES LESS THAN (2004),
    PARTITION p94 VALUES LESS THAN (2005),
    PARTITION p95 VALUES LESS THAN (2006),
    PARTITION p96 VALUES LESS THAN (2007),
    PARTITION p97 VALUES LESS THAN (2008),
    PARTITION p98 VALUES LESS THAN (2009),
    PARTITION p99 VALUES LESS THAN (2010),
    PARTITION p100 VALUES LESS THAN (2011),
    PARTITION p101 VALUES LESS THAN (2012),
    PARTITION p102 VALUES LESS THAN (2013),
    PARTITION p103 VALUES LESS THAN (2014),
    PARTITION p104 VALUES LESS THAN (2015),
    PARTITION p105 VALUES LESS THAN (2016),
    PARTITION p106 VALUES LESS THAN (2017),
    PARTITION p107 VALUES LESS THAN (2018),
    PARTITION p108 VALUES LESS THAN (2019),
    PARTITION p109 VALUES LESS THAN (2020),
    PARTITION p110 VALUES LESS THAN (2021),
    PARTITION p111 VALUES LESS THAN (2022),
    PARTITION p112 VALUES LESS THAN (2023),
    PARTITION p113 VALUES LESS THAN (2024), -- 民國113年，西元2024年
    PARTITION p114 VALUES LESS THAN MAXVALUE
);

CREATE TABLE institutional_investors (
    stock_id VARCHAR(10) NOT NULL,
    date DATE NOT NULL,
    foreign_buy BIGINT, -- 外資買進股數
    foreign_sell BIGINT, -- 外資賣出股數
    foreign_net_buy BIGINT, -- 外資買賣超股數
    dealer_buy BIGINT, -- 自營商買進股數
    dealer_sell BIGINT, -- 自營商賣出股數
    foreign_buy_excluding_dealers BIGINT, -- 外陸資買進股數(不含外資自營商)
    foreign_sell_excluding_dealers BIGINT, -- 外陸資賣出股數(不含外資自營商)
    foreign_net_buy_excluding_dealers BIGINT, -- 外陸資買賣超股數(不含外資自營商)
    dealer_foreign_buy BIGINT, -- 外資自營商買進股數
    dealer_foreign_sell BIGINT, -- 外資自營商賣出股數
    dealer_foreign_net_buy BIGINT, -- 外資自營商買賣超股數
    investment_trust_buy BIGINT, -- 投信買進股數
    investment_trust_sell BIGINT, -- 投信賣出股數
    investment_trust_net_buy BIGINT, -- 投信買賣超股數
    dealer_net_buy BIGINT, -- 自營商買賣超股數
    dealer_self_buy BIGINT, -- 自營商買進股數(自行買賣)
    dealer_self_sell BIGINT, -- 自營商賣出股數(自行買賣)
    dealer_self_net_buy BIGINT, -- 自營商買賣超股數(自行買賣)
    dealer_hedge_buy BIGINT, -- 自營商買進股數(避險)
    dealer_hedge_sell BIGINT, -- 自營商賣出股數(避險)
    dealer_hedge_net_buy BIGINT, -- 自營商買賣超股數(避險)
    total_institution_net_buy BIGINT, -- 三大法人買賣超股數
    PRIMARY KEY (stock_id, date)
) PARTITION BY RANGE(YEAR(date)) (
    PARTITION p88 VALUES LESS THAN (1999),  -- 民國88年，西元1999年
    PARTITION p89 VALUES LESS THAN (2000),
    PARTITION p90 VALUES LESS THAN (2001),
    PARTITION p91 VALUES LESS THAN (2002),
    PARTITION p92 VALUES LESS THAN (2003),
    PARTITION p93 VALUES LESS THAN (2004),
    PARTITION p94 VALUES LESS THAN (2005),
    PARTITION p95 VALUES LESS THAN (2006),
    PARTITION p96 VALUES LESS THAN (2007),
    PARTITION p97 VALUES LESS THAN (2008),
    PARTITION p98 VALUES LESS THAN (2009),
    PARTITION p99 VALUES LESS THAN (2010),
    PARTITION p100 VALUES LESS THAN (2011),
    PARTITION p101 VALUES LESS THAN (2012),
    PARTITION p102 VALUES LESS THAN (2013),
    PARTITION p103 VALUES LESS THAN (2014),
    PARTITION p104 VALUES LESS THAN (2015),
    PARTITION p105 VALUES LESS THAN (2016),
    PARTITION p106 VALUES LESS THAN (2017),
    PARTITION p107 VALUES LESS THAN (2018),
    PARTITION p108 VALUES LESS THAN (2019),
    PARTITION p109 VALUES LESS THAN (2020),
    PARTITION p110 VALUES LESS THAN (2021),
    PARTITION p111 VALUES LESS THAN (2022),
    PARTITION p112 VALUES LESS THAN (2023),
    PARTITION p113 VALUES LESS THAN (2024), -- 民國113年，西元2024年
    PARTITION p114 VALUES LESS THAN MAXVALUE
);

CREATE TABLE PE_ratios (
    stock_id VARCHAR(10) NOT NULL,
    date DATE NOT NULL,
    PE_ratio DECIMAL(10, 2),
    PRIMARY KEY (stock_id, date)
) PARTITION BY RANGE(YEAR(date)) (
    PARTITION p88 VALUES LESS THAN (1999),  -- 民國88年，西元1999年
    PARTITION p89 VALUES LESS THAN (2000),
    PARTITION p90 VALUES LESS THAN (2001),
    PARTITION p91 VALUES LESS THAN (2002),
    PARTITION p92 VALUES LESS THAN (2003),
    PARTITION p93 VALUES LESS THAN (2004),
    PARTITION p94 VALUES LESS THAN (2005),
    PARTITION p95 VALUES LESS THAN (2006),
    PARTITION p96 VALUES LESS THAN (2007),
    PARTITION p97 VALUES LESS THAN (2008),
    PARTITION p98 VALUES LESS THAN (2009),
    PARTITION p99 VALUES LESS THAN (2010),
    PARTITION p100 VALUES LESS THAN (2011),
    PARTITION p101 VALUES LESS THAN (2012),
    PARTITION p102 VALUES LESS THAN (2013),
    PARTITION p103 VALUES LESS THAN (2014),
    PARTITION p104 VALUES LESS THAN (2015),
    PARTITION p105 VALUES LESS THAN (2016),
    PARTITION p106 VALUES LESS THAN (2017),
    PARTITION p107 VALUES LESS THAN (2018),
    PARTITION p108 VALUES LESS THAN (2019),
    PARTITION p109 VALUES LESS THAN (2020),
    PARTITION p110 VALUES LESS THAN (2021),
    PARTITION p111 VALUES LESS THAN (2022),
    PARTITION p112 VALUES LESS THAN (2023),
    PARTITION p113 VALUES LESS THAN (2024), -- 民國113年，西元2024年
    PARTITION p114 VALUES LESS THAN MAXVALUE
);


CREATE TABLE trading_volumes (
    stock_id VARCHAR(10) NOT NULL,
    date DATE NOT NULL,
    volume BIGINT,
    PRIMARY KEY (stock_id, date)
) PARTITION BY RANGE(YEAR(date)) (
    PARTITION p88 VALUES LESS THAN (1999),  -- 民國88年，西元1999年
    PARTITION p89 VALUES LESS THAN (2000),
    PARTITION p90 VALUES LESS THAN (2001),
    PARTITION p91 VALUES LESS THAN (2002),
    PARTITION p92 VALUES LESS THAN (2003),
    PARTITION p93 VALUES LESS THAN (2004),
    PARTITION p94 VALUES LESS THAN (2005),
    PARTITION p95 VALUES LESS THAN (2006),
    PARTITION p96 VALUES LESS THAN (2007),
    PARTITION p97 VALUES LESS THAN (2008),
    PARTITION p98 VALUES LESS THAN (2009),
    PARTITION p99 VALUES LESS THAN (2010),
    PARTITION p100 VALUES LESS THAN (2011),
    PARTITION p101 VALUES LESS THAN (2012),
    PARTITION p102 VALUES LESS THAN (2013),
    PARTITION p103 VALUES LESS THAN (2014),
    PARTITION p104 VALUES LESS THAN (2015),
    PARTITION p105 VALUES LESS THAN (2016),
    PARTITION p106 VALUES LESS THAN (2017),
    PARTITION p107 VALUES LESS THAN (2018),
    PARTITION p108 VALUES LESS THAN (2019),
    PARTITION p109 VALUES LESS THAN (2020),
    PARTITION p110 VALUES LESS THAN (2021),
    PARTITION p111 VALUES LESS THAN (2022),
    PARTITION p112 VALUES LESS THAN (2023),
    PARTITION p113 VALUES LESS THAN (2024), -- 民國113年，西元2024年
    PARTITION p114 VALUES LESS THAN MAXVALUE
);
